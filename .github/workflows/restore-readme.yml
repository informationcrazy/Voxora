name: Restore Custom README

# 触发条件：只有当 README.md 被修改并推送到 main 分支时才运行
# Trigger: Only run when README.md is modified and pushed to main
on:
  push:
    paths:
      - 'README.md'
    branches:
      - main  # 如果你的主分支叫 master，请把这里改成 master

# 权限设置：允许机器人修改仓库内容
permissions:
  contents: write

jobs:
  restore-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository (检出代码)
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Check and Restore README (检查并恢复)
        run: |
          # 1. 检查是否存在我们要的模板文件
          if [ -f .github/README_TEMPLATE.md ]; then
            echo "Found template, restoring..."
            
            # 2. 强制用模板覆盖当前的 README.md
            cp .github/README_TEMPLATE.md README.md
            
            # 3. 配置 Git 身份 (机器人身份)
            git config --global user.name 'README Guardian Bot'
            git config --global user.email 'actions@github.com'
            
            # 4. 检查是否有变化，如果有就提交并推送到仓库
            if [[ `git status --porcelain README.md` ]]; then
              git add README.md
              git commit -m "Auto-restore: Reverted AI Studio override to custom README"
              git push
              echo "README restored successfully!"
            else
              echo "README matches template. No changes needed."
            fi
          else
            echo "Template file not found! Skipping restoration."
          fi
